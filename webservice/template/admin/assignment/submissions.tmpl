{{define "title"}}User Submissions{{end}}
{{define "head"}}{{end}}
{{define "content"}}

    <h2 class="display-4 mb-3">{{ .Assignment.Name }} submissions</h2>
    <h5>{{ .SubmissionCount }} submitted</h5>
    <table class="table table-striped table-sm">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Submitted</th>
            <th scope="col">Reviews</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        {{$A := .Assignment}}
        {{ range .Students }}
            {{ if not .User.Teacher }}
                <tr class="clickable-row">
                    <th scope="row">{{ .User.ID }}</th>
                    <td>{{ .User.Name }}</td>
                    <td><a href="mailto:{{ .User.EmailStudent }}">{{ .User.EmailStudent }}</a></td>
                    <td>{{if .Submitted}}{{PRETTYTIME .SubmittedTime }}{{end}}</td>
                    <td>{{if .Reviewed}}<a href="/admin/assignment/{{$A.ID}}/review/{{.User.ID}}">See review(s)</a>{{end}}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            {{if .Submitted}}
                                <a href="/admin/assignment/{{ $A.ID }}/submission/{{ .User.ID }}" class="btn btn-info">Preview</a>
                                <a class="btn btn-danger" onclick="deleteConfirm({{$A.ID}}, {{.User.ID}})">Delete</a>
                            {{end}}
                        </div>
                    </td>
                </tr>
            {{ end }}
        {{ end }}
        </tbody>
    </table>
{{end}}
{{define "foot"}}
    <script>
        function deleteConfirm(assignmentID, userID) {
            if (window.confirm('Are you sure you want to delete this submission?')) {
                let url = `/admin/assignment/submission/delete`;
                fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        'assignment_id': parseInt(assignmentID),
                        'user_id': parseInt(userID),
                    })
                })
                .then(response => {
                    if (response.status === 200) {
                        return response.json()
                    }

                    return {}
                })
                .then(json => {
                    window.alert(json.message);
                    location.reload();
                })
                .catch(error => {
                    window.alert(error);
                });
            }
        }
    </script>
{{end}}