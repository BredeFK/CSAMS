{{ define "content" }}
    <h2 class="display-4 mb-3">Create assignment</h2>
    <hr>
    <div class="row">
        <div class="col-3">
            <p class="lead">Add field to assignment</p>
            <hr>
            <button class="btn btn-light btn-block border" id="btn_textfield">Textfield</button>
            <button class="btn btn-light btn-block border" id="btn_textarea">Textarea</button>
            <button class="btn btn-light btn-block border" id="btn_checkbox">Checkbox</button>
            <button class="btn btn-light btn-block border" id="btn_radio">Radio</button>
            <hr>
            <button class="btn btn-success btn-block" id="save">Save</button>
        </div>

        <div class="col-9" id="output"></div>
    </div>
    <script>
        let data = [];

        let output = document.getElementById('output');
        let form = [];
        let priorities = [];

        let types = ['textfield', 'textarea', 'checkbox', 'radio'];

        types.forEach(type => {
            document.getElementById('btn_' + type).addEventListener('click', e => {
                e.preventDefault();
                createField(type);
            });
        });

        document.getElementById('save').addEventListener('click', e => {
            fetch('/admin/assignment/create', {
                method: 'post',
                headers: {
                    'Content-type': 'application/json; charset=UTF-8'
                },
                body: JSON.stringify(data),
            }).then(e => {
                console.log(JSON.stringify(data));
            }).catch(err => {
                console.error('Request failed', err)
            });
        });

        function createField(type) {
            let card = document.createElement('div');
            card.classList.add('card', 'mb-3');

            data[form.length] = {
                'type': type,
                'question': '',
                'description': '',
                'priority': form.length.toString(),
            };

            card.appendChild(createCardHeader());
            card.appendChild(createCardBody());
            card.appendChild(createCardFooter(type));

            form.push(card);

            displayForm();
        }

        function updateData() {
            for (let i = 0; i < form.length; i++) {
                data[i].question = document.getElementById(`question_${i}`).value;
                data[i].description = document.getElementById(`description_${i}`).value;
                data[i].priority = document.getElementById(`priority_${i}`).value;
            }
        }

        function displayForm() {
            output.innerHTML = '';

            for (let i = 0; i < form.length; i++) {
                output.appendChild(form[i]);
            }
        }

        function createCardHeader() {
            let cardHeader = document.createElement('div');
            cardHeader.classList.add('card-header');

            let row = document.createElement('div');
            row.classList.add('row');

            let col_10 = document.createElement('div');
            col_10.classList.add('col-10');

            col_10.appendChild(createQuestionField());

            let col_2 = document.createElement('div');
            col_2.classList.add('col-2');

            col_2.appendChild(createPrioritySelect());

            row.appendChild(col_10);
            row.appendChild(col_2);

            cardHeader.appendChild(row);

            return cardHeader;
        }

        function createQuestionField() {
            let question = document.createElement('input');
            question.setAttribute('type', 'text');
            question.classList.add('form-control');
            question.setAttribute('placeholder', 'Question');
            question.id = `question_${form.length}`;
            question.setAttribute('onChange', 'updateData()');

            return question;
        }

        function createPrioritySelect() {
            let prior = document.createElement('input');
            prior.setAttribute('type', 'text');
            prior.setAttribute('placeholder', 'Priority');
            prior.classList.add('form-control');
            prior.id = `priority_${form.length}`;
            prior.setAttribute('onchange', 'updateData()');

            return prior;
        }

        function createCardBody() {
            let cardBody = document.createElement('div');
            cardBody.classList.add('card-body');

            let textarea = document.createElement('textarea');
            textarea.classList.add('form-control');
            textarea.setAttribute('placeholder', 'Description');
            textarea.id = `description_${form.length}`;
            textarea.setAttribute('onChange', 'updateData()');

            cardBody.appendChild(textarea);

            return cardBody;
        }

        function createCardFooter(type) {
            switch (type) {
                case 'textfield':
                    return getTextfield();
                case 'textarea':
                    return getTextarea();
                case 'checkbox':
                    return getCheckbox();
                case 'radio':
                    return getRadio();
            }
        }

        function getTextfield() {
            let cardFooter = document.createElement('div');
            cardFooter.classList.add('card-footer');

            let input = document.createElement('input');
            input.setAttribute('type', 'text');
            input.classList.add('form-control');
            input.setAttribute('placeholder', 'Short Answer');
            input.setAttribute('disabled', '');

            cardFooter.appendChild(input);

            return cardFooter;
        }

        function getTextarea() {
            let cardFooter = document.createElement('div');
            cardFooter.classList.add('card-footer');

            let textarea = document.createElement('textarea');
            textarea.classList.add('form-control');
            textarea.setAttribute('placeholder', 'Long Answer');
            textarea.setAttribute('disabled', '');

            cardFooter.appendChild(textarea);

            return cardFooter;
        }

        function getCheckbox() {
            let cardFooter = document.createElement('div');
            cardFooter.classList.add('card-footer');

            let formCheck = document.createElement('div');
            formCheck.classList.add('form-check');

            let input = document.createElement('input');
            input.setAttribute('type', 'checkbox');
            input.setAttribute('disabled', '');
            input.classList.add('form-check-input');

            let label = document.createElement('label');
            label.classList.add('form-check-label');
            label.innerText = "True / False";

            formCheck.appendChild(input);
            formCheck.appendChild(label);

            cardFooter.appendChild(formCheck);

            return cardFooter;
        }

        function getRadio() {
            let cardFooter = document.createElement('div');
            cardFooter.classList.add('card-footer');

            for (let i = 1; i <= 5; i++) {
                let formCheck = document.createElement('div');
                formCheck.classList.add('form-check', 'form-check-inline');

                let input = document.createElement('input');
                input.setAttribute('type', 'radio');
                input.setAttribute('disabled', '');
                input.classList.add('form-check-input');

                if (i === 3) {
                    input.setAttribute('checked', '');
                }

                let label = document.createElement('label');
                label.classList.add('form-check-label');
                label.innerText = i.toString();

                formCheck.appendChild(input);
                formCheck.appendChild(label);

                cardFooter.appendChild(formCheck);
            }

            return cardFooter;
        }

        Array.prototype.swap = function(a, b) {
            let temp = this[a];
            this[a] = this[b];
            this[b] = temp;
        };
    </script>
{{ end }}